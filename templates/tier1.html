{% extends 'base_login_signup.html' %}

{% block title %} Tier1 {% endblock%}

{  {% block style %}
<style>
    table, th, tr, td{
            border-collapse: collapse;
            border: 1px solid #ddd;
            width: 75%;
           }
    table{
        position: relative;

]
    }
    </style>
{% endblock%}
{% block t1 %}{% endblock %}
{% block logout%}
    <button type="button" id="logout_btn"  onclick="window.location.href='/logout/'">Logout</button>
    <button type="button" id="twofa_manage" onclick="window.location.href='/two_factor/'">Two factor manage</button>
    <button type="button" id="account_update_btn"  onclick="window.location.href='/account_update/?id={{ user.id }}'">Account Update</button>
    <button type="button" id="account_open_btn"  onclick="window.location.href='/account_open/'">open new account</button>
    <button type="button" id="make_trans_btn"  onclick="window.location.href='/make_transfer/'"> Transfer</button>
    <button type="button" id="sessions_btn"  onclick="window.location.href='/account/sessions/'"> Session</button>

{% endblock %}
{% block usertype %}<usertype>{{ user.username }}, {{ user.user_type }}, {{ user.email }}, {{ user.phone }}</usertype>{% endblock %}
{% block content %}

        <!--User Info-->
        <t1 >External Users</t1>
        <table >
            <tr>
                <th>Username</th>
                <th>TYPE</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Update</th>
            </tr>
            {% for user in users %}
            <tr>
                <td> {{ user.username }}</td>
                <td> {{ user.user_type }}</td>
                <td> {{ user.email }}</td>
                <td> {{ user.phone }}</td>
                <td> {{ user.address }}</td>

                <td>
                    {% if user.state == 'INACTIVE' %}
                        INACTIVE
                    {% else %}
                        <button type="submit" id="account_update_btn"  onclick="window.location.href='/account_update/?id={{ user.id }}'">Update</button>
                    {% endif %}
                </td>

            </tr>
            {% endfor %}
            </table>

        <br>

        <!--Account open request-->
        <t1>Account Open Request</t1>
        <table >
            <tr>
                <th>Date</th>
                <th>From</th>
                <th>To</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Request T2</th>
                <th>Checking</th>
                <th>Saving</th>
                <th>Credit</th>
                <th>Status</th>

            </tr>
            {% for request in account_open_requests %}
            <tr>
                <td> {{ request.created }}</td>
                <td> {{ request.from_username }}</td>
                <td> {{ request.to_username }}</td>
                <td> {{ request.email }}</td>
                <td> {{ request.phone }}</td>
                <td> {{ request.address }}</td>
                <td><!--for T1, 'WAITING_T2', 'WAITING_T2_EX', 'WAITING_EX', 'WAITING' -->
                    {% if request.state != "APPROVED" %}
                        {% if  request.sub_state == "WAITING_T2_EX"  or request.sub_state == "WAITING_T2"%}
                            <form action="/make_approve_request/" method="POST"> {% csrf_token %}
                                <input type="hidden" value="" name="to_username" />
                                <input type="hidden" value="{{ request.id }}" name="request_id" />
                                <input type="hidden" value="TIER2" name="user_type" />
                                <button type="submit" name="send_request_t1"> SEND</button>
                            </form>
                        {% else %}
                            -
                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>

                <td>{{ request.checking_balance }}</td>
                <td>{{ request.saving_balance }}</td>
                <td>{{ request.credit_balance }}</td>
                <td>
                    {% if request.state == "PENDING" %}
                        <form action="/request_approve_post/" method="POST"> {% csrf_token %}
                            <input type="hidden" value="{{ request.id }}" name="id" />
                            <input type="hidden" value="1" name="approve" />
                            <button type="submit" name="approve_btn"> APPROVE</button>
                        </form>

                        <form action="/request_approve_post/" method="POST"> {% csrf_token %}
                            <input type="hidden" value="{{ request.id }}" name="id" />
                            <input type="hidden" value="0" name="approve" />
                            <button type="submit" name="decline_btn"> Decline</button>
                        </form>

                    {% else %}
                        {{ request.state }}

                    {% endif %}

                </td>

            </tr>
            {% endfor %}
            </table>
        <br>

        <!--Account update request-->
        <t1>Account update request</t1>
        <table >
            <tr>
                <th>Date</th>
                <th>From</th>
                <th>To</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Request T2</th>
                <th>Request CUS</th>
                <th>Status</th>
            </tr>
            {% for request in account_update_requests %}
            <tr>
                <td> {{ request.created }}</td>
                <td> {{ request.from_username }}</td>
                <td> {{ request.to_username }}</td>
                <td> {{ request.email }}</td>
                <td> {{ request.phone }}</td>
                <td> {{ request.address }}</td>
                <td>
                    {% if request.state !=  "APPROVED"  and  request.state !=  "DECLINED" %}
                        {% if request.sub_state == "WAITING_T2_EX"  or request.sub_state == "WAITING_T2"%}
                            <form action="/make_approve_request/" method="POST"> {% csrf_token %}
                                <input type="hidden" value="" name="to_username" />
                                <input type="hidden" value="{{ request.id }}" name="request_id" />
                                <input type="hidden" value="TIER2" name="user_type" />
                                <button type="submit" name="send_request_t1"> SEND</button>
                            </form>
                        {% elif request.sub_state == "WAITING_EX" %}
                            approved
                        {% else %}

                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if request.state !=  "APPROVED"  and  request.state !=  "DECLINED" %}
                         {% if request.sub_state == "WAITING_T2_EX"  or request.sub_state == "WAITING_EX"%}
                            <form action="/make_approve_request/" method="POST"> {% csrf_token %}

                                <input type="hidden" value="{{ request.to_username }}" name="to_username" />
                                <input type="hidden" value="{{ request.id }}" name="request_id" />
                                <input type="hidden" value="CUSTOMER" name="user_type" />

                                <button type="submit" name="send_request_cus"> SEND</button>
                            </form>
                        {% elif request.sub_state == "WAITING_T2"  %}
                            approved
                        {% else %}

                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>
              <td>
                  {% if request.state == "PENDING" %}
                      <form action="/request_approve_post/" method="POST"> {% csrf_token %}
                          <input type="hidden" value="{{ request.id }}" name="id" />
                          <input type="hidden" value="1" name="approve" />
                          <button type="submit" name="decline_btn"> APPROVE</button>
                      </form>

                      <form action="/request_approve_post/" method="POST"> {% csrf_token %}
                          <input type="hidden" value="{{ request.id }}" name="id" />
                          <input type="hidden" value="0" name="approve" />
                          <button type="submit" name="decline_btn"> Decline</button>
                      </form>

                {% else %}
                    {{ request.state }}

                {% endif %}

                </td>
            </tr>
            {% endfor %}
        </table>
        <br>

        <!--Fund transfer request-->
        <t1>Fund transfer request</t1>
        <table >
            <tr>
                <th>Date</th>
                <th>From</th>
                <th>To</th>
                <th>Money</th>
                <th>Critical</th>
                <th>Request T2</th>
                <th>Request EXT</th>
                <th>Status</th>
            </tr>
            {% for request in fund_requests %}
            <tr>
                <td> {{ request.created }}</td>
                <td> {{ request.from_username }}</td>
                <td> {{ request.to_username }}</td>
                <td> {{ request.money }}</td>
                <td>
                    {% if  request.critical == 1 %}
                        v
                    {% else %}
                        x

                    {% endif %}
                </td>
                <td>
                    {% if request.critical != 1 and request.state !=  "APPROVED"  and  request.state !=  "DECLINED" %}
                        {% if request.sub_state == "WAITING_T2_EX"  or request.sub_state == "WAITING_T2"%}
                            <form action="/make_approve_request/" method="POST"> {% csrf_token %}
                                <input type="hidden" value="" name="to_username" />
                                <input type="hidden" value="{{ request.id }}" name="request_id" />
                                <input type="hidden" value="TIER2" name="user_type" />
                                <button type="submit" name="send_request_t2"> SEND</button>
                            </form>
                        {% elif request.sub_state == "WAITING_EX" %}
                            approved
                        {% else %}

                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if request.critical != 1 and request.state !=  "APPROVED"  and  request.state !=  "DECLINED" %}
                         {% if request.sub_state == "WAITING_T2_EX"  or request.sub_state == "WAITING_EX"%}
                            <form action="/make_approve_request/" method="POST"> {% csrf_token %}

                                <input type="hidden" value="{{ request.from_username }}" name="to_username" />
                                <input type="hidden" value="{{ request.id }}" name="request_id" />
                                <input type="hidden" value="CUSTOMER" name="user_type" />

                                <button type="submit" name="send_request_cus"> SEND</button>
                            </form>
                        {% elif request.sub_state == "WAITING_T2"  %}
                            approved
                        {% else %}

                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>
              <td>
                  {% if request.critical != 1 and request.state == "PENDING" %}
                      <form action="/request_approve_post/" method="POST"> {% csrf_token %}
                          <input type="hidden" value="{{ request.id }}" name="id" />
                          <input type="hidden" value="1" name="approve" />
                          <button type="submit" name="decline_btn"> APPROVE</button>
                      </form>

                      <form action="/request_approve_post/" method="POST"> {% csrf_token %}
                          <input type="hidden" value="{{ request.id }}" name="id" />
                          <input type="hidden" value="0" name="approve" />
                          <button type="submit" name="decline_btn"> Decline</button>
                      </form>

                {% else %}
                    {{ request.state }}

                {% endif %}

                </td>
            </tr>
            {% endfor %}
        </table>
        <br>

        <!--payment request-->
        <t1>Payment request</t1>
        <table >
            <tr>
                <th>Date</th>
                <th>From</th>
                <th>To</th>
                <th>Money</th>
                <th>Critical</th>
                <th>Request T2</th>
                <th>Request EXT</th>
                <th>Status</th>
            </tr>
            {% for request in payment_requests %}
            <tr>
                <td> {{ request.created }}</td>
                <td> {{ request.from_username }}</td>
                <td> {{ request.to_username }}</td>
                <td> {{ request.money }}</td>
                <td>
                    {% if  request.critical == 1 %}
                        v
                    {% else %}
                        x

                    {% endif %}
                </td>
                <td>
                    {% if request.critical != 1 and request.state !=  "APPROVED"  and  request.state !=  "DECLINED" %}
                        {% if request.sub_state == "WAITING_T2_EX"  or request.sub_state == "WAITING_T2"%}
                            <form action="/make_approve_request/" method="POST"> {% csrf_token %}
                                <input type="hidden" value="" name="to_username" />
                                <input type="hidden" value="{{ request.id }}" name="request_id" />
                                <input type="hidden" value="TIER2" name="user_type" />
                                <button type="submit" name="send_request_t2"> SEND</button>
                            </form>
                        {% elif request.sub_state == "WAITING_EX" %}
                            approved
                        {% else %}

                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if request.critical != 1 and request.state !=  "APPROVED"  and  request.state !=  "DECLINED" %}
                         {% if request.sub_state == "WAITING_T2_EX"  or request.sub_state == "WAITING_EX"%}
                            <form action="/make_approve_request/" method="POST"> {% csrf_token %}

                                <input type="hidden" value="{{ request.from_username }}" name="to_username" />
                                <input type="hidden" value="{{ request.id }}" name="request_id" />
                                <input type="hidden" value="CUSTOMER" name="user_type" />

                                <button type="submit" name="send_request_cus"> SEND</button>
                            </form>
                        {% elif request.sub_state == "WAITING_T2"  %}
                            approved
                        {% else %}

                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>
              <td>
                  {% if request.critical != 1 and request.state == "PENDING" %}
                      <form action="/request_approve_post/" method="POST"> {% csrf_token %}
                          <input type="hidden" value="{{ request.id }}" name="id" />
                          <input type="hidden" value="1" name="approve" />
                          <button type="submit" name="decline_btn"> APPROVE</button>
                      </form>

                      <form action="/request_approve_post/" method="POST"> {% csrf_token %}
                          <input type="hidden" value="{{ request.id }}" name="id" />
                          <input type="hidden" value="0" name="approve" />
                          <button type="submit" name="decline_btn"> Decline</button>
                      </form>

                {% else %}
                    {{ request.state }}

                {% endif %}

                </td>
            </tr>
            {% endfor %}
        </table>
        <br>

{% endblock %}

<script>
    function myfunction() {
        //if (request.state=="APPROVED"){
        button.approve_btn.style.display == "none";
        //}

    }
</script>>